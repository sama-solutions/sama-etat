<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_membership_member_tree" model="ir.ui.view">
        <field name="name">membership.member.tree</field>
        <field name="model">membership.member</field>
        <field name="arch" type="xml">
            <list string="Membres" default_order="membership_number">
                <field name="membership_number"/>
                <field name="name"/>
                <field name="expiration_date"/>
                <field name="days_until_expiration" string="Jours restants"/>
                <field name="expiration_category" string="Catégorie"/>
                <field name="has_photo" widget="boolean_toggle"/>
                <field name="membership_age_days" string="Âge (jours)"/>
                <field name="card_status" widget="badge" decoration-success="card_status == 'valid'" decoration-danger="card_status == 'expired'"/>
                <button name="action_open_public_page" type="object" string="" icon="fa-external-link" help="Ouvrir la page publique" class="btn-link"/>
            </list>
        </field>
    </record>

    <record id="view_membership_member_form" model="ir.ui.view">
        <field name="name">membership.member.form</field>
        <field name="model">membership.member</field>
        <field name="arch" type="xml">
            <form string="Membre">
                <header>
                    <button name="action_open_public_page" type="object" class="oe_highlight" string="Voir profil public" icon="fa-external-link" help="Ouvrir la page publique du membre"/>
                </header>
                <sheet>
                    <field name="image_1920" widget="image" class="oe_avatar"/>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1><field name="name" placeholder="Nom du membre"/></h1>
                        <h3>
                            <label for="membership_number" class="oe_edit_only"/>
                            <field name="membership_number" readonly="1"/>
                        </h3>
                    </div>
                    <notebook>
                        <page string="Informations Principales">
                            <group>
                                <group string="Dates et Statut">
                                    <field name="expiration_date"/>
                                    <field name="days_until_expiration" readonly="1"/>
                                    <field name="expiration_category" readonly="1"/>
                                    <field name="company_id" groups="base.group_multi_company"/>
                                </group>
                                <group string="Statistiques">
                                    <field name="membership_age_days" readonly="1"/>
                                    <field name="has_photo" readonly="1"/>
                                    <field name="card_status" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        <page string="QR Code &amp; Accès Public">
                            <group>
                                <group>
                                    <field name="barcode_qr" widget="image" nolabel="1"/>
                                </group>
                                <group>
                                    <label for="public_url" string="Page Publique"/>
                                    <div class="o_row">
                                        <field name="public_url" widget="url" readonly="1" class="oe_inline"/>
                                        <button name="action_open_public_page" type="object" string="Ouvrir" class="btn-link" icon="fa-external-link" help="Ouvrir la page publique du membre"/>
                                    </div>
                                </group>
                            </group>
                        </page>
                        <page string="Termes &amp; Conditions">
                            <group>
                                <field name="terms_and_conditions" nolabel="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Vue Kanban -->
    <record id="view_membership_member_kanban" model="ir.ui.view">
        <field name="name">membership.member.kanban</field>
        <field name="model">membership.member</field>
        <field name="arch" type="xml">
            <kanban default_group_by="card_status" class="o_kanban_mobile">
                <style>
                    .o_kanban_record .o_kanban_image {
                        width: 64px;
                        height: 64px;
                        margin-right: 10px;
                        flex-shrink: 0;
                    }
                    .o_kanban_record .o_kanban_image img {
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        border-radius: 50%;
                        border: 2px solid #fff;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    }
                    .oe_kanban_card {
                        display: flex;
                        align-items: flex-start;
                        padding: 10px;
                        margin-bottom: 8px;
                        border-radius: 8px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    }
                    .oe_kanban_details {
                        flex: 1;
                        min-width: 0;
                    }
                    .o_kanban_record_title {
                        font-weight: 600;
                        color: #2c3e50;
                        margin-bottom: 4px;
                    }
                    .o_kanban_record_subtitle {
                        font-size: 0.85em;
                        color: #7f8c8d;
                    }
                    .badge {
                        font-size: 0.75em;
                        padding: 2px 8px;
                        border-radius: 12px;
                    }
                    .badge-success {
                        background-color: #27ae60;
                        color: white;
                    }
                    .badge-danger {
                        background-color: #e74c3c;
                        color: white;
                    }
                </style>
                <field name="id"/>
                <field name="name"/>
                <field name="membership_number"/>
                <field name="image_1920"/>
                <field name="expiration_date"/>
                <field name="card_status"/>
                <field name="public_url"/>
                <field name="company_id"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_image">
                                <img t-if="record.image_1920.raw_value" t-att-src="`/web/image/membership.member/${record.id.raw_value}/image_1920/128x128`" alt="Photo"/>
                                <img t-else="" src="/web/static/src/img/placeholder.png" alt="Pas de photo"/>
                            </div>
                            <div class="oe_kanban_details">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title"><field name="name"/></strong>
                                        <br/>
                                        <small class="o_kanban_record_subtitle text-muted">
                                            <field name="membership_number"/>
                                        </small>
                                    </div>
                                    <div class="o_kanban_manage_button_section">
                                        <a class="o_kanban_manage_toggle_button" href="#">
                                            <i class="fa fa-ellipsis-v" role="img" aria-label="Manage" title="Manage"/>
                                        </a>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="expiration_date" widget="date"/>
                                    <div class="mt-2">
                                        <span t-if="record.card_status.raw_value == 'valid'" class="badge badge-success">Valide</span>
                                        <span t-else="" class="badge badge-danger">Expirée</span>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="company_id" widget="many2one_avatar_user"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <button name="action_open_public_page" type="object" class="btn btn-sm btn-outline-primary" title="Voir page publique">
                                            <i class="fa fa-external-link"/>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Vue Graphique -->
    <record id="view_membership_member_graph" model="ir.ui.view">
        <field name="name">membership.member.graph</field>
        <field name="model">membership.member</field>
        <field name="arch" type="xml">
            <graph string="Analyse des Membres" type="bar" stacked="True">
                <field name="card_status" type="row"/>
                <field name="company_id" type="col"/>
                <field name="id" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Vue Pivot -->
    <record id="view_membership_member_pivot" model="ir.ui.view">
        <field name="name">membership.member.pivot</field>
        <field name="model">membership.member</field>
        <field name="arch" type="xml">
            <pivot string="Tableau Croisé Dynamique">
                <field name="card_status" type="row"/>
                <field name="company_id" type="col"/>
                <field name="expiration_date" type="col" interval="month"/>
                <field name="id" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Vue Calendrier -->
    <record id="view_membership_member_calendar" model="ir.ui.view">
        <field name="name">membership.member.calendar</field>
        <field name="model">membership.member</field>
        <field name="arch" type="xml">
            <calendar string="Calendrier des Expirations" date_start="expiration_date" color="card_status" event_open_popup="True">
                <field name="name"/>
                <field name="membership_number"/>
                <field name="card_status"/>
            </calendar>
        </field>
    </record>

    <!-- Action avec toutes les vues -->
    <record id="action_membership_member" model="ir.actions.act_window">
        <field name="name">Membres</field>
        <field name="res_model">membership.member</field>
        <field name="view_mode">kanban,list,form,graph,pivot,calendar</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Créez votre premier membre !</p>
            <p>Utilisez les différentes vues pour analyser vos données :</p>
            <ul>
                <li><strong>Kanban</strong> : Vue en cartes par statut</li>
                <li><strong>Liste</strong> : Vue tabulaire classique</li>
                <li><strong>Graphique</strong> : Analyse visuelle des données</li>
                <li><strong>Tableau croisé</strong> : Analyse multidimensionnelle</li>
                <li><strong>Calendrier</strong> : Suivi des dates d'expiration</li>
            </ul>
        </field>
    </record>

    <!-- Action pour ouvrir la galerie des cartes -->
    <record id="action_open_member_gallery" model="ir.actions.act_url">
        <field name="name">Galerie des Cartes</field>
        <field name="url">/members/gallery</field>
        <field name="target">new</field>
    </record>

    <menuitem id="menu_membership_root" name="Gestion des Membres" sequence="10" web_icon="sama_carte,static/description/icon.png"/>
    <menuitem id="menu_membership_member" name="Membres" parent="menu_membership_root" action="action_membership_member" sequence="10"/>
    <menuitem id="menu_membership_gallery" name="Galerie des Cartes" parent="menu_membership_root" action="action_open_member_gallery" sequence="20"/>
</odoo>