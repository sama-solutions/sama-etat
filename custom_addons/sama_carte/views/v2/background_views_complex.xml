<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vues pour la gestion des fonds d'√©cran -->
    
    <!-- Vue Kanban des fonds d'√©cran -->
    <record id="view_membership_card_background_kanban" model="ir.ui.view">
        <field name="name">membership.card.background.kanban</field>
        <field name="model">membership.card.background</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="id"/>
                <field name="name"/>
                <field name="technical_name"/>
                <field name="category"/>
                <field name="is_premium"/>
                <field name="usage_count"/>
                <field name="image_portrait"/>
                <field name="image_landscape"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_image">
                                <img t-att-src="kanban_image('membership.card.background', 'image_portrait', record.id.raw_value)" 
                                     alt="Portrait" class="o_image_64_cover"/>
                            </div>
                            <div class="oe_kanban_details">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <small class="o_kanban_record_subtitle text-muted">
                                            <field name="category"/>
                                            <t t-if="record.is_premium.raw_value">
                                                <span class="badge badge-warning ms-1">Premium</span>
                                            </t>
                                        </small>
                                    </div>
                                    <div class="o_kanban_record_top_right">
                                        <span class="badge badge-pill badge-info">
                                            <field name="usage_count"/> utilisations
                                        </span>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <field name="description"/>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <button type="object" name="action_preview_portrait" 
                                                class="btn btn-sm btn-outline-primary">
                                            <i class="fa fa-mobile"/> Portrait
                                        </button>
                                        <button type="object" name="action_preview_landscape" 
                                                class="btn btn-sm btn-outline-secondary">
                                            <i class="fa fa-desktop"/> Paysage
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Vue Liste des fonds d'√©cran -->
    <record id="view_membership_card_background_tree" model="ir.ui.view">
        <field name="name">membership.card.background.tree</field>
        <field name="model">membership.card.background</field>
        <field name="arch" type="xml">
            <list string="Fonds d'√©cran">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="technical_name"/>
                <field name="category"/>
                <field name="is_premium"/>
                <field name="usage_count"/>
                <button type="object" name="action_preview_portrait" 
                        string="Portrait" icon="fa-mobile" 
                        class="btn-outline-primary"/>
                <button type="object" name="action_preview_landscape" 
                        string="Paysage" icon="fa-desktop" 
                        class="btn-outline-secondary"/>
            </list>
        </field>
    </record>

    <!-- Vue Formulaire des fonds d'√©cran -->
    <record id="view_membership_card_background_form" model="ir.ui.view">
        <field name="name">membership.card.background.form</field>
        <field name="model">membership.card.background</field>
        <field name="arch" type="xml">
            <form string="Fond d'√©cran">
                <header>
                    <button type="object" name="action_preview_portrait" 
                            string="Carte Portrait" 
                            class="btn-primary" icon="fa-mobile"/>
                    <button type="object" name="action_preview_landscape" 
                            string="Carte Paysage" 
                            class="btn-secondary" icon="fa-desktop"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1><field name="name" placeholder="Nom du fond d'√©cran"/></h1>
                    </div>
                    <group>
                        <group>
                            <field name="technical_name"/>
                            <field name="category"/>
                            <field name="sequence"/>
                        </group>
                        <group>
                            <field name="is_premium"/>
                            <field name="usage_count" readonly="1"/>
                        </group>
                    </group>
                    <group string="Description">
                        <field name="description" nolabel="1"/>
                    </group>
                    <notebook>
                        <page string="Images">
                            <group>
                                <group string="Portrait">
                                    <field name="image_portrait" widget="image" class="oe_avatar"/>
                                </group>
                                <group string="Paysage">
                                    <field name="image_landscape" widget="image" class="oe_avatar"/>
                                </group>
                            </group>
                        </page>
                        <page string="Pr√©visualisation">
                            <div class="row">
                                <div class="col-md-6">
                                    <h4>Portrait</h4>
                                    <div class="card" style="max-width: 300px;">
                                        <img t-if="image_portrait" 
                                             t-att-src="image_data_uri(image_portrait)" 
                                             class="card-img-top" 
                                             style="height: 400px; object-fit: cover;"/>
                                        <div class="card-body">
                                            <h5 class="card-title">Format Portrait</h5>
                                            <p class="card-text">Optimis√© pour mobile et cartes verticales</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h4>Paysage</h4>
                                    <div class="card" style="max-width: 400px;">
                                        <img t-if="image_landscape" 
                                             t-att-src="image_data_uri(image_landscape)" 
                                             class="card-img-top" 
                                             style="height: 250px; object-fit: cover;"/>
                                        <div class="card-body">
                                            <h5 class="card-title">Format Paysage</h5>
                                            <p class="card-text">Optimis√© pour desktop et cartes horizontales</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Action pour les fonds d'√©cran -->
    <record id="action_membership_card_background" model="ir.actions.act_window">
        <field name="name">Fonds d'√©cran des cartes</field>
        <field name="res_model">membership.card.background</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Ajoutez votre premier fond d'√©cran !</p>
            <p>
                Les fonds d'√©cran permettent de personnaliser l'apparence des cartes de membres.
                Vous pouvez uploader des images en format portrait et paysage.
            </p>
        </field>
    </record>

    <!-- Menu pour les fonds d'√©cran -->
    <menuitem id="menu_membership_card_background" 
              name="üñºÔ∏è Fonds d'√©cran" 
              parent="menu_membership_root" 
              action="action_membership_card_background" 
              sequence="30"/>

    <!-- Extension de la vue soci√©t√© pour les fonds d'√©cran -->
    <record id="view_company_form_background" model="ir.ui.view">
        <field name="name">res.company.form.background</field>
        <field name="model">res.company</field>
        <field name="inherit_id" ref="sama_carte.view_company_form_card_customization"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='card_colors']" position="after">
                <group string="üñºÔ∏è Fond d'√©cran" name="card_background">
                    <field name="card_background_id" 
                           options="{'no_create': True, 'no_edit': True}"/>
                    <field name="card_background_orientation"/>
                    <div t-if="card_background_id" class="mt-3">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Aper√ßu Portrait</h6>
                                <img t-att-src="'/web/image/membership.card.background/' + str(card_background_id) + '/image_portrait'" 
                                     class="img-thumbnail" 
                                     style="max-width: 150px; max-height: 200px;"/>
                            </div>
                            <div class="col-md-6">
                                <h6>Aper√ßu Paysage</h6>
                                <img t-att-src="'/web/image/membership.card.background/' + str(card_background_id) + '/image_landscape'" 
                                     class="img-thumbnail" 
                                     style="max-width: 200px; max-height: 150px;"/>
                            </div>
                        </div>
                    </div>
                </group>
            </xpath>
        </field>
    </record>
</odoo>